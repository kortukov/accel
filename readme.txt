3 скрипта для разметки данных

Во всех скриптах чтобы они заработали на другом компьютере достаточно прописать пути к папкам с файлами. В моём случае сами скрипты лежали в папке /home/evgeny/lab/task, .ann и video_data.mat лежали в соседних папках ann и clean_data. Перед тем как запускать скрипты надо подчистить .ann файлы руками. Какие и как - смотри в конце readme.

hustle_labels.m добавляет к clean_data файлам вектор  hustle_timing с кадрами метаний, и бинарный вектор hustle_timecourse с помощью txt файлов из папки hustle_01. Время метаний получается если написать timing[hustle_timing]. За кадр с метанием взят первый, отстоящий меньше чем на 0.05 секунды. Между кадрами там 0.033 секунды, но я взял такое число. Можно и чуть поменьше, хотя мне кажется это не принципиально для разметки.

synchro.m синхронизирует стимулы и реакции с ээг и с камеры. А именно, добавляет к clean_data файлам векторы st_timing и rs_timing длины (число эпох) c помощью ann файлов из папки ann. Также он добавляет вектор rs_timecourse для последующей визуализации. Алгоритм синхронизации взят простой: проверяем, совпадает ли количество стимулов, если нет - заносим файл в corrupt_files.mat. Если совпадает, считаем вектор разницы между стимулами, прибавляем его к стимулам и реакциям с ээг. Получаем стимулы и реакции во времени рассчитанном камерой. 
Попутно этот скрипт исправляет отсутствие реакций в анн файле и лишние реакции. 

final_labels.m собирает итоговый вектор разметки по эпохам для всех размеченных файлов, собирает он его из трёх векторов - st_timing, rs_timing, hustle_timing
Пока он останавливается после визуализации трёх векторов timecourse для стимулов, ответов и метаний пальца, чтобы по ним смотреть дальше, насколько корректен непосредственно итоговый вектор разметки по эпохам.

Скриптик file_check.m надо использовать, чтобы проверить файлы которые в процессе работы synchro.m попадают в corrupt_files.mat. Ставим в начале цикла например от for i = 5:5 чтобы посмотреть пятый файл. Далее смотрим st_times_eeg и st_times_vid, сравниваем. Пытаемся понять почему отличаются.
Я начну, найденные косяки в .ann файлах буду записывать внизу.
Нашёл несколько файлов в которых на видео пара лишних стимулов. Если пробежать глазом st_times_vid иногда видно, где лишние и можно просто руками затереть в stim_timecourse и сразу засейвить его в video_data.
Кроме указанных внизу двух .ann файлов, остальные 48 случаев действительно с ошибками в количестве стимулов на видео. ЭЭГ на всех запипсано нормально, так что исправив все .ann указанные ниже, можно считать данные с ЭЭГ корректными.
Значит следующий шаг - попытаться разобраться с testing1.m(вторым алгоритмом синхронизации) и сделать так чтобы он не накапливал ошибку.



